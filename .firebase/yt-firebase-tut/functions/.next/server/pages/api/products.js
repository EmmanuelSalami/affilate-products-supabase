"use strict";(()=>{var e={};e.id=583,e.ids=[583],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},5320:(e,r,t)=>{t.r(r),t.d(r,{config:()=>j,default:()=>S,routeModule:()=>b});var s={};t.r(s),t.d(s,{default:()=>w,readProducts:()=>h});var o=t(3480),a=t(8667),n=t(6435);let i=require("fs/promises");var d=t.n(i);let u=require("path");var l=t.n(u);let c=require("@supabase/supabase-js"),p=process.env.SUPABASE_URL,f=process.env.SUPABASE_ANON_KEY,m=(0,c.createClient)(p,f),g=l().join(process.cwd(),"data","products.json"),h=async()=>{try{let{data:e,error:r}=await m.from("products").select("*");if(r)throw r;return console.log("✅ Loaded products from Supabase"),e}catch(e){console.warn("⚠️ Supabase read failed, using local JSON:",e.message);try{let e=await d().readFile(g,"utf-8");return JSON.parse(e)}catch(e){return console.error("❌ Failed to read products.json:",e.message),[]}}},A=async e=>{try{let{data:r,error:t}=await m.from("products").select("*").eq("id",e).single();if(t)throw t;return r}catch(e){return console.error("Error fetching product by ID:",e.message),null}},y=async e=>{try{let{data:r,error:t}=await m.from("products").select("*").ilike("title",`%${e}%`);if(t)throw t;return r}catch(e){return console.error("Search failed:",e.message),[]}},P=async e=>{try{let{data:r,error:t}=await m.from("products").delete().in("id",e);if(t)throw t;return{deletedCount:r.length,deletedIds:r.map(e=>e.id),remainingCount:"unknown (query again if needed)"}}catch(e){throw console.error("Supabase delete error:",e.message),Error("Failed to delete products")}},E=e=>{let r=e.headers["x-api-key"]||e.query.api_key||e.body&&e.body.api_key,t=e.headers.referer||"",s=e.headers.host||"";return!!(t&&t.includes(s))||r===process.env.API_KEY};async function w(e,r){if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, DELETE, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, X-API-Key"),"OPTIONS"===e.method)return r.status(200).end();if(!("GET"===e.method||E(e)))return r.status(401).json({error:"Invalid or missing API key"});try{if("GET"===e.method){let{id:t,title:s}=e.query;if(t){let e=await A(t);if(e)return r.status(200).json(e);return r.status(404).json({message:`Product with ID ${t} not found`})}if(s){let e=await y(s);return r.status(200).json(e)}{let e=await h();return r.status(200).json(e)}}if("POST"===e.method)try{let{title:t,imageUrl:s,description:o,productUrl:a}=e.body;if(!t||!a)return r.status(400).json({message:"Missing required fields: title and productUrl are required"});let n={id:crypto.randomUUID(),title:t,imageUrl:s||"https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg",description:o||"",productUrl:a},{data:i,error:d}=await m.from("products").insert([n]).select();if(d)throw d;return r.status(201).json(i[0])}catch(e){return console.error("POST /api/products error:",e.message),r.status(500).json({message:"Error adding product",error:e.message})}if("DELETE"===e.method)try{let{ids:t}=e.body;if(!t||!Array.isArray(t)||0===t.length)return r.status(400).json({message:'Request body must include an "ids" array'});let s=await P(t);return r.status(200).json({message:`Successfully deleted ${s.deletedCount} products`,...s})}catch(e){return console.error("DELETE /api/products error:",e.message),r.status(500).json({message:"Error deleting products",error:e.message})}else r.setHeader("Allow",["GET","POST","DELETE"]),r.status(405).end(`Method ${e.method} Not Allowed`)}catch(e){console.error("/api/products error:",e.message),r.status(500).json({message:"Server error",error:e.message})}}let S=(0,n.M)(s,"default"),j=(0,n.M)(s,"config"),b=new o.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/products",pathname:"/api/products",bundlePath:"",filename:""},userland:s})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=5320);module.exports=t})();